variables:
  DOCKER_BUILDKIT: '1'

stages:
  - build
  - publish

build:
  stage: build
  tags:
    - docker
  image: tarantool/tarantool:1.x-centos7
  before_script:
    - yum -y install git gcc make unzip which
    - tarantoolctl rocks install ldoc --server=http://rocks.moonscript.org
  script:
    - tarantoolctl rocks make
    - ./taptest.lua
    - ./release.sh
    - make doc
  artifacts:
    name: "$CI_COMMIT_REF_NAME"
    paths:
      - doc/
      - release/
      - release-doc/

# publish
include:
  remote: https://tarantool.github.io/rocks.tarantool.org/helpers/gitlab-publish-rockspec.yml
